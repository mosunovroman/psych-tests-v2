# EPIC 06 – Аудио‑медитации и расширенный контент релаксации

## Goal
Добавить **плейер с аудио‑медитациями** (5‑10 минут) и улучшить существующие дыхательные упражнения (звуковые сигналы) к концу 4‑й недели.

## Deliverables
1. **Библиотека аудио‑файлов** (MP3/ogg) в Cloudflare R2 (public bucket).  
2. Компонент `AudioPlayer` (React) с:
   - плей/пауза, прогресс‑бар, таймер, возможность скачивать.
   - автоматическое выключение звука после завершения.
3. Добавить **Sound cues** к каждому дыхательному упражнению (4‑7‑8, квадратное, заземление).
4. UI‑страница `Relaxation` → список: `Meditation`, `Breathing`, `Progressive Muscle Relaxation`.  
5. Возможность **скачать** отдельный трек (для офлайн‑использования).  

## Acceptance Criteria
- ✅ Плейер воспроизводит аудио без лагов в Chrome/Firefox/Safari (mobile‑friendly).  
- ✅ Каждый трек отображает длительность и текущий тайм‑код.  
- ✅ При переходе в офлайн‑режим уже скачанные треки продолжают играть (Cache API).  
- ✅ Звуковые сигналы в дыхательных упражнениях синхронны с анимациями.  
- ✅ Тесты покрывают 80 % `AudioPlayer` (unit + integration).  

## Tasks
| № | Описание | Owner | Est. (ч) |
|---|----------|-------|----------|
| 1 | Записать/закупить 5‑6 медитаций (2 ч аудио‑продакшн) | Content | 4 |
| 2 | Создать Cloudflare R2 bucket, загрузить MP3, настроить CORS | DevOps | 2 |
| 3 | Реализовать `AudioPlayer` (React + Howler.js) | Front‑end | 5 |
| 4 | Интегрировать аудио‑плейер в `RelaxationPage` | Front‑end | 3 |
| 5 | Добавить звуковые сигналы в существующие breathing‑анимации (Web Audio API) | Front‑end | 4 |
| 6 | Реализовать “Download” кнопку (blob → <a download>) | Front‑end | 2 |
| 7 | Писать unit‑тесты (Jest + @testing-library/react) | QA/Dev | 5 |
| 8 | Обновить сервис‑воркер для кеширования аудио‑файлов (Cache‑first) | Front‑end | 3 |
| **Итого** | | | **28 ч** |

## Dependencies
- **Epic 03** (PWA) – понадобится Service Worker для кеша аудио.  
- **Epic 01** – базовый UI‑компонентный каркас.  

## Risks & Mitigation
| Risk | Impact | Mitigation |
|------|--------|------------|
| Авторские права на медитации | Высокий | Использовать лицензированные Creative‑Commons треки или собственные записи (контракт с музыкантом). |
| Большой вес аудио (мб/трек) → медленная загрузка | Средний | Использовать **Compression** (AAC 128 kbps) + **range requests** в R2. |
| На мобильных Safari ограничение автоплей | Средний | Требовать пользовательский клик перед проигрыванием (сообщение “Tap to start”). |

## Best‑Practice Tips
- **Howler.js** + `react-howler` упрощает синхронный контроль (play/pause/seek).  
- В `manifest.json` добавить `"audio"` в `"scope"` → Chrome покажет в “Add to Home Screen”.  
- Хранить метаданные треков (title, duration, mood) в `relaxationConfig.json` – легко расширять.  

---  


